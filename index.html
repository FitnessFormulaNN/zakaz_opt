<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Лист заказа SNT</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f7f6; }
        h2 { color: #333; }
        .controls { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input[type="text"] { padding: 8px; width: 300px; border: 1px solid #ddd; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; background: #fff; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #007bff; color: white; position: sticky; top: 0; }
        tr:hover { background-color: #f1f1f1; }
        .qty-input { width: 60px; padding: 5px; text-align: center; }
        .summary { position: fixed; bottom: 0; right: 0; background: #333; color: #fff; padding: 20px; border-radius: 10px 0 0 0; box-shadow: -2px -2px 10px rgba(0,0,0,0.3); }
        .total-val { font-size: 1.2em; font-weight: bold; color: #4caf50; }
        .file-upload { margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2>Бланк заказа продукции SNT</h2>

    <div class="controls">
        <div class="file-upload">
            <label>Выберите файл CSV: </label>
            <input type="file" id="csvFile" accept=".csv">
        </div>
        <input type="text" id="searchInput" placeholder="Поиск по названию..." onkeyup="filterTable()">
    </div>

    <table id="productTable">
        <thead>
            <tr>
                <th>Наименование</th>
                <th>Розница (₽)</th>
                <th>Опт (₽)</th>
                <th>Кол-во</th>
                <th>Сумма (опт)</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <div class="summary">
        <div>Товаров: <span id="totalItems">0</span></div>
        <div>Итого к оплате (опт): <span id="totalPrice" class="total-val">0</span> ₽</div>
    </div>

    <script>
        const fileInput = document.getElementById('csvFile');
        const tableBody = document.querySelector('#productTable tbody');
        let products = [];

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                const text = event.target.result;
                processData(text);
            };

            reader.readAsText(file, 'UTF-8');
        });

        function processData(csvText) {
            const lines = csvText.split(/\r?\n/);
            tableBody.innerHTML = '';
            products = [];

            lines.forEach((line, index) => {
                if (line.trim() === '') return;

                // Разделяем по точке с запятой (как в твоем примере)
                // Обработка кавычек для названий, содержащих запятые
                const parts = line.split(';');
                
                if (parts.length >= 3) {
                    const name = parts[0].replace(/"/g, '');
                    const retail = parseFloat(parts[1]);
                    const wholesale = parseFloat(parts[2]);

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${name}</td>
                        <td>${retail}</td>
                        <td>${wholesale}</td>
                        <td><input type="number" class="qty-input" min="0" value="0" onchange="calculateTotal()"></td>
                        <td class="row-total">0</td>
                    `;
                    tableBody.appendChild(row);
                }
            });
        }

        function filterTable() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const rows = tableBody.getElementsByTagName('tr');

            for (let row of rows) {
                const name = row.cells[0].textContent.toLowerCase();
                row.style.display = name.includes(query) ? '' : 'none';
            }
        }

        function calculateTotal() {
            let totalSum = 0;
            let totalQty = 0;
            const rows = tableBody.getElementsByTagName('tr');

            for (let row of rows) {
                const wholesale = parseFloat(row.cells[2].textContent);
                const qty = parseInt(row.querySelector('.qty-input').value) || 0;
                const rowTotalCell = row.querySelector('.row-total');
                
                const rowSum = wholesale * qty;
                rowTotalCell.textContent = rowSum;
                
                if (qty > 0) {
                    totalSum += rowSum;
                    totalQty += qty;
                }
            }

            document.getElementById('totalPrice').textContent = totalSum.toLocaleString();
            document.getElementById('totalItems').textContent = totalQty;
        }
    </script>
</body>
</html>
