<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNT | Order Sheet</title>
    <style>
        :root {
            --primary: #000000;
            --text-main: #1a1a1a;
            --text-muted: #888888;
            --border: #eeeeee;
            --accent: #22c55e;
            --focus-ring: #e5e7eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #ffffff;
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px 140px 20px;
            display: flex;
            justify-content: center;
        }

        .container { width: 100%; max-width: 900px; }

        header { margin-bottom: 40px; }
        h1 { font-size: 22px; font-weight: 600; letter-spacing: -0.5px; margin: 0 0 10px 0; }

        #search {
            width: 100%;
            padding: 15px 0;
            border: none;
            border-bottom: 1px solid var(--border);
            font-size: 18px;
            outline: none;
            transition: border-color 0.2s;
        }
        #search:focus { border-color: var(--primary); }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        
        th { 
            text-align: left; 
            font-size: 11px; 
            text-transform: uppercase; 
            color: var(--text-muted); 
            padding: 15px 0;
            font-weight: 500;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border);
        }

        /* Выравнивание по вертикали для всех ячеек */
        td { 
            padding: 16px 0; 
            border-bottom: 1px solid var(--border); 
            vertical-align: middle; 
        }

        .product-name { font-size: 15px; line-height: 1.4; padding-right: 20px; font-weight: 400; }
        
        .prices { white-space: nowrap; width: 140px; }
        .retail { font-size: 12px; color: var(--text-muted); text-decoration: line-through; display: block; margin-bottom: 2px; }
        .wholesale { font-weight: 600; font-size: 15px; }

        /* Поле ввода количества */
        .qty-input {
            width: 90px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            outline: none;
            transition: all 0.2s;
            -moz-appearance: textfield;
        }

        .qty-input::-webkit-outer-spin-button,
        .qty-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        .qty-input:focus { 
            border-color: var(--primary); 
            box-shadow: 0 0 0 3px var(--focus-ring);
        }

        /* Placeholder для пустых полей */
        .qty-input::placeholder { color: #d1d1d6; font-weight: 400; }

        .row-total { 
            text-align: right; 
            font-weight: 600; 
            font-size: 15px; 
            width: 120px; 
        }

        /* Панель итогов */
        .footer-panel {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 20px 40px;
            border-radius: 60px;
            display: flex;
            align-items: center;
            gap: 50px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            z-index: 100;
        }

        .stat { display: flex; flex-direction: column; }
        .stat-label { font-size: 10px; text-transform: uppercase; opacity: 0.5; letter-spacing: 1px; margin-bottom: 2px; }
        .stat-value { font-size: 22px; font-weight: 700; }
        .total-highlight { color: var(--accent); }

        tr.active { background-color: #fcfcfc; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>SNT Order List</h1>
        <input type="text" id="search" placeholder="Поиск товара..." onkeyup="filter()">
    </header>

    <table id="mainTable">
        <thead>
            <tr>
                <th>Наименование</th>
                <th>Цена (Р/О)</th>
                <th style="text-align: center;">Количество</th>
                <th style="text-align: right;">Итого</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<div class="footer-panel">
    <div class="stat">
        <span class="stat-label">Позиций</span>
        <span id="countItems" class="stat-value">0</span>
    </div>
    <div class="stat">
        <span class="stat-label">Сумма заказа</span>
        <span id="grandTotal" class="stat-value total-highlight">0 ₽</span>
    </div>
</div>

<script>
    async function loadData() {
        try {
            const response = await fetch('products.json');
            const products = await response.json();
            const tbody = document.getElementById('tableBody');

            tbody.innerHTML = products.map(p => `
                <tr>
                    <td class="product-name">${p.name}</td>
                    <td class="prices">
                        <span class="retail">${p.retail} ₽</span>
                        <span class="wholesale">${p.wholesale} ₽</span>
                    </td>
                    <td style="text-align: center;">
                        <input type="number" class="qty-input" placeholder="0" 
                               oninput="updateRow(this, ${p.wholesale})">
                    </td>
                    <td class="row-total">0 ₽</td>
                </tr>
            `).join('');
        } catch (err) {
            console.error("Ошибка: убедитесь, что products.json доступен.");
        }
    }

    function updateRow(input, price) {
        // Если поле пустое, считаем как 0
        const val = input.value;
        const qty = val === "" ? 0 : parseInt(val);
        
        const row = input.closest('tr');
        const totalCell = row.querySelector('.row-total');
        
        // Расчет суммы строки
        totalCell.innerText = (qty * price).toLocaleString() + ' ₽';
        
        // Визуальный акцент
        if (qty > 0) row.classList.add('active');
        else row.classList.remove('active');

        calculateTotal();
    }

    function calculateTotal() {
        let totalSum = 0;
        let totalQty = 0;

        document.querySelectorAll('#tableBody tr').forEach(row => {
            const input = row.querySelector('.qty-input');
            const qty = input.value === "" ? 0 : parseInt(input.value);
            
            if (qty > 0) {
                const priceText = row.querySelector('.wholesale').innerText;
                const price = parseFloat(priceText.replace(/[^0-9.-]+/g,""));
                totalSum += (qty * price);
                totalQty += 1;
            }
        });

        document.getElementById('grandTotal').innerText = totalSum.toLocaleString() + ' ₽';
        document.getElementById('countItems').innerText = totalQty;
    }

    function filter() {
        const query = document.getElementById('search').value.toLowerCase();
        document.querySelectorAll('#tableBody tr').forEach(row => {
            const name = row.querySelector('.product-name').innerText.toLowerCase();
            row.style.display = name.includes(query) ? '' : 'none';
        });
    }

    window.onload = loadData;
</script>

</body>
</html>
